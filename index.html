<head>
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""
    />

    <link rel="stylesheet" href="style.css" />

    <script
        src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Overhead Visualization</title>
</head>

<div id="sidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
        >&times;</a
    >
    <form onsubmit="saveAPIKey(event)">
        <label for="apiKeyInput">TomTom API-Key:</label>
        <input type="text" id="apiKeyInput" name="APIKey" placeholder="Your API-Key">
        <label for="vehicleDataInput">Vehicle Data (Array):</label>
        <input type="text" id="vehicleDataInput" name="vehicleData" placeholder="[{name: ...}, {...}, ...]">
        <input type="submit" value="Save">
    </form>


    <form onsubmit="applyCostData(event)">
        <h2> Combustion </h2>
        <label for="gasPriceInput">Price per liter:</label>
        <input type="number" id="gasPriceInput" name="gasPrice" placeholder="Gas price" step="0.001">
        <label for="gasConsumptionInput">Gas consumption per 100km in liter:</label>
        <input type="number" id="gasConsumptionInput" name="gasConsumption" placeholder="consumption in liter" step="0.001">
        <h2> Electric </h2>
        <label for="pricekWhInput">Price per kWh:</label>
        <input type="number" id="pricekWhInput" name="pricekWh" placeholder="price" step="0.001">
        <input type="submit" value="Save">
    </form>
</div>

<div id="main">
    <div id="map"></div>
</div>

<h1 onclick="openNav()"><span>Visualization</span></h1>

<script src="helpers.js"></script>
<script src="data/cityData.js"></script>
<script src="data/routeData.js"></script>
<script src="map.js"></script>
<script src="calculateRoutes.js"></script>

<script>
    function openNav() {
        document.getElementById("sidebar").style.width = "400px";
    }

    function closeNav() {
        document.getElementById("sidebar").style.width = "0";
    }

    var vehicleData = [];
    var gasPrice = 0;
    var gasConsumption = 0;
    var kWhPrice = 0;

    function saveAPIKey(e) {
        e.preventDefault();
        const APIKey = $("#apiKeyInput").val();
        localStorage.setItem("API-Key", APIKey);
        try {
            const rawVehicleData = $("#vehicleDataInput").val();
            const parsedData = JSON.parse(rawVehicleData);
            localStorage.setItem("vehicleData", JSON.stringify(parsedData));
            vehicleData = parsedData;
        }
        catch (e){
            window.alert(e);
            console.warn(e);
        }
    }

    try {
        $("#apiKeyInput").val(localStorage.getItem("API-Key"));
        $("#vehicleDataInput").val(localStorage.getItem("vehicleData"));
        const rawVehicleData = localStorage.getItem("vehicleData");
        if (rawVehicleData) {
            vehicleData = JSON.parse(rawVehicleData);
        }
    }
    catch (e) {
        console.warn(e);
    }

    function applyCostData(e) {
        e.preventDefault();
        gasPrice = $("#gasPriceInput").val();
        gasConsumption = $("#gasConsumptionInput").val();
        kWhPrice = $("#pricekWhInput").val();
        console.log(gasPrice, gasConsumption, kWhPrice);
    }
</script>
